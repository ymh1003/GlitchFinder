# Gcode-Checking-Project
This repository contains scripts for comparing two G-code files. It is particularly useful for analyzing differences between G-code files that are intended to represent the **same model** but **differ** in orientation, slicer settings, or source — differences that often reveal issues in mesh geometry or highlight the effectiveness of slicers and mesh repair tools.

## Requirements
The required Python packages are listed below (see `requirements.txt`):
```
numpy<2  
open3d  
tqdm  
pyntcloud  
memory_profiler  
```
Install them with:
```
pip install -r requirements.txt
```
## Usage
The core script is `gcode_comp_Z.py`. Given two G-code files and a set of configuration parameters, the script performs the following steps:
1. Reconstructs a set of cuboids from each G-code file.
2. Samples a point cloud from the reconstructed geometry of each file.
3. Divides the overall bounding box covering both point clouds into smaller unit boxes.
4. Computes the Hausdorff distance between the subsets of the two point clouds within each unit box.

The outputs include:
* A **distribution graph** of the computed distances
* A **heatmap** where color encodes the magnitude of local distances
* A **JSON file** that records all parameters and results

Run it with:
```
python gcode_comp_Z.py [-h] [-c CENTER_X CENTER_Y] [-s SAMPLING] [-b BOXSIZE_X BOXSIZE_Y BOXSIZE_Z]
                       [-t THRESHOLD] [-d DECIMAL] [--bound BOUND_MIN BOUND_MAX] [--name NAME]
                       [--collect COLLECT] [--rerun RERUN]
                       imd_file imd_ot rot_file rot_ot orig_dim
```
The script assumes that both G-code files are generated with the model placed at the same position on the build plate. The G-code parser currently supports only files generated by Cura or PrusaSlicer.

Key options:
* `-c`: XY coordinates of the rotation center — i.e., the placement position of the models on the build plate. This is typically the center of the build plate. Default: `150 150`.
* `-s`: Sampling gap of the point cloud sampling process. Default: `0.1`.
* `-b`: Length, width, height of the unit box. Default: `1.0 1.0 1.0`.
* `-t`: Threshold percentile used in the heatmap generation process — i.e., any region of the model with a distance below this threshold is considered *error-free* and is assigned the lightest possible color. Default: `90`.
* `--bound`: Overall bounding box covering both point clouds. If not provided, this will be automatically computed from the metadata sections of the two G-code files.
* `--name`: Name of the model.
* `--collect`: Specifies the JSON file where all parameters and results will be saved. All other output files, including the distribution graph and heatmap, will be stored in the same directory as the JSON file.
* `--prusa`: Include this flag if the first G-code file was generated by PrusaSlicer.
* `imd_file`, `rot_file`: Paths to the two G-code files to compare.
* `imd_ot`, `rot_ot`: Orientations of the two G-code files to compare. Format: `x,y,z`.
* `orig_dim`: Dimension of the model. Format: `x,y,z`.

For example:
```
python gcode_comp_Z.py cube_1.gcode 0,0,90 cube_2.gcode 0,90,0 10,10,10 --name cube --collect /tmp/cube/cube.json
```
This command compares two G-code files of the same 10×10×10 model (both sliced with Cura). One G-code was generated after rotating the model 90 degrees about the Z-axis, and the other after a 90-degree rotation about the Y-axis. All results — including the JSON file, distribution graph, and heatmap — will be saved to `/tmp/cube/`.

## Results Integration
When you have multiple heatmaps for the same model and want to merge them into a single overall heatmap, use `heatmap_merge.py`:
```
python heatmap_merge.py [-h] [-t THRESHOLD] [-n NAME] [--distribution] json_files [json_files ...]
```
where:
* `-t`: Threshold percentile used in the heatmap generation process — i.e., any region of the model with a distance below this threshold is considered *error-free* and is assigned the lightest possible color. Default: `90`.
* `-n`: Name of the model.
* `--distribution`: Include this flag to generate the overall distribution graph in addition to the merged heatmap.
* `json_files [json_files ...]`: List of JSON files to be integrated.
